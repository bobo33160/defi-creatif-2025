<!DOCTYPE html>
<html lang="fr">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1" />
<title>D√©fi Cr√©atif Quotidien - Avanc√©</title>
<style>
  :root {
    --primary-color: #2a9d8f;
    --accent-color: #e76f51;
    --background-light: #f0f4f8;
    --text-color-light: #264653;
    --background-dark: #1e1e1e;
    --text-color-dark: #e0e0e0;
    --btn-bg: var(--primary-color);
    --btn-hover-bg: #217373;
  }
  body {
    margin: 0; font-family: 'Arial', sans-serif;
    background: var(--background-light);
    color: var(--text-color-light);
    display: flex; flex-direction: column; min-height: 100vh;
    transition: background 0.3s, color 0.3s;
  }
  body.dark-mode {
    background: var(--background-dark);
    color: var(--text-color-dark);
  }
  header {
    background: var(--primary-color); color: white; padding: 1rem; text-align: center;
    font-weight: bold; font-size: 1.5rem;
  }
  main {
    flex-grow: 1;
    display: flex; flex-direction: column; align-items: center; justify-content: flex-start;
    padding: 2rem 1rem;
    max-width: 700px;
    margin: 0 auto;
  }
  #defi {
    background: white;
    border-radius: 10px;
    box-shadow: 0 4px 8px rgb(0 0 0 / 0.1);
    padding: 2rem;
    width: 100%;
    font-size: 1.2rem;
    text-align: center;
    margin-bottom: 1.5rem;
    min-height: 100px;
    transition: background 0.3s, color 0.3s;
  }
  body.dark-mode #defi {
    background: #333;
    color: var(--text-color-dark);
  }
  button, input[type="submit"] {
    background-color: var(--btn-bg);
    border: none;
    color: white;
    padding: 1rem 2rem;
    border-radius: 5px;
    font-size: 1rem;
    cursor: pointer;
    transition: background-color 0.3s ease;
    margin-bottom: 1rem;
  }
  button:hover, input[type="submit"]:hover {
    background-color: var(--btn-hover-bg);
  }
  form {
    width: 100%;
    background: white;
    border-radius: 10px;
    box-shadow: 0 4px 8px rgb(0 0 0 / 0.1);
    padding: 1rem 1.5rem;
    margin-bottom: 2rem;
  }
  body.dark-mode form {
    background: #333;
    color: var(--text-color-dark);
  }
  label {
    display: block;
    margin-top: 1rem;
  }
  textarea, input[type="text"] {
    width: 100%;
    padding: 0.5rem;
    font-size: 1rem;
    border-radius: 5px;
    border: 1px solid #ccc;
  }
  textarea {
    min-height: 80px;
    resize: vertical;
    margin-top: 0.5rem;
  }
  .small-text {
    font-size: 0.85rem;
    color: #666;
  }
  .error {
    color: red;
    margin-top: 0.2rem;
  }
  footer {
    background: var(--primary-color);
    color: white;
    text-align: center;
    padding: 1rem;
    font-size: 0.9rem;
  }
  a.don-link {
    color: var(--accent-color);
    font-weight: bold;
    text-decoration: none;
  }
  a.don-link:hover, a.don-link:focus {
    text-decoration: underline;
  }
  .footer-text {
    margin: 0.5rem 0;
  }
  @media (max-width: 600px) {
    #defi {
      font-size: 1rem;
      padding: 1.2rem;
    }
    button, input[type="submit"] {
      width: 100%;
    }
    form {
      padding: 1rem;
    }
  }
  #dark-mode-toggle {
    position: fixed;
    top: 1rem;
    right: 1rem;
    background: var(--btn-bg);
    border: none;
    color: white;
    padding: 0.6rem 1rem;
    cursor: pointer;
    border-radius: 5px;
    z-index: 1000;
    user-select: none;
  }
  #partageSocial button {
    margin: 0 0.3rem 0.3rem 0.3rem;
  }
  #badgesContainer div {
    font-weight: bold;
  }
  li {
    margin-bottom: 0.5rem;
  }
</style>
</head>
<body>

<header>D√©fi Cr√©atif Quotidien - Avanc√©</header>

<button id="dark-mode-toggle" aria-pressed="false" aria-label="Activer ou d√©sactiver le mode sombre">Mode sombre</button>

<main>
  <div id="defi" aria-live="polite" aria-atomic="true" tabindex="0">
    Chargement du d√©fi...
  </div>
  <button id="nouveauDefi" aria-label="G√©n√©rer un nouveau d√©fi cr√©atif">Nouveau d√©fi</button>

  <div id="partageSocial" aria-label="Boutons de partage social" style="margin-bottom:1rem;">
    <button id="shareTwitter" aria-label="Partager sur Twitter">Twitter</button>
    <button id="shareFacebook" aria-label="Partager sur Facebook">Facebook</button>
    <button id="shareWhatsApp" aria-label="Partager sur WhatsApp">WhatsApp</button>
  </div>

  <section aria-labelledby="proposer-defi-title" style="width:100%; max-width:700px;">
    <h2 id="proposer-defi-title">Proposez un nouveau d√©fi</h2>
    <form id="defiForm" novalidate>
      <label for="defiInput">Votre d√©fi (5 √† 150 caract√®res) <span aria-hidden="true">*</span></label>
      <textarea id="defiInput" name="defiInput" required minlength="5" maxlength="150" aria-describedby="defiHelp"></textarea>
      <div id="defiHelp" class="small-text">Soyez cr√©atif et clair.</div>
      <div id="formError" class="error" role="alert" aria-live="assertive" style="display:none;"></div>
      <label for="captcha">Combien font 3 + 2 ? <span aria-hidden="true">*</span></label>
      <input type="text" id="captcha" name="captcha" required aria-describedby="captchaHelp" />
      <div id="captchaHelp" class="small-text">Pour prouver que vous n'√™tes pas un robot.</div>

      <input type="submit" value="Envoyer" aria-label="Soumettre votre d√©fi" />
    </form>
  </section>

  <section style="width:100%; max-width:700px; margin-top:2rem;" aria-label="Liste des d√©fis soumis avec votes">
    <h2>D√©fis propos√©s par la communaut√©</h2>
    <ul id="defisSubmitList" style="list-style:none; padding-left:0;"></ul>
  </section>

  <section style="width:100%; max-width:700px; margin-top:2rem;" aria-label="Historique personnel des d√©fis">
    <h2>Votre journal des d√©fis r√©alis√©s</h2>
    <label for="searchHistorique">Rechercher dans votre journal :</label>
    <input type="text" id="searchHistorique" aria-label="Rechercher dans l'historique des d√©fis" placeholder="Mot-cl√© √† rechercher" style="width:100%; padding:0.5rem; margin-bottom:1rem;">
    <button id="exportJournal" aria-label="T√©l√©charger le journal de vos d√©fis">Exporter en texte</button>
    <ul id="historiqueDefis" aria-live="polite" style="padding-left:1rem;"></ul>
  </section>

  <section style="width:100%; max-width:700px; margin-top:2rem;" aria-label="Badges utilisateur">
    <h2>Vos badges</h2>
    <div id="badgesContainer" aria-live="polite"></div>
  </section>

  <section style="width:100%; max-width:700px; margin-top:4rem;">
    <h2>Param√®tres de rappel</h2>
    <label for="notifToggle">
      <input type="checkbox" id="notifToggle" />
      Activer le rappel quotidien avec notification
    </label>
  </section>

  <section id="disqus_thread" style="max-width:700px; margin-top:4rem;"></section>
</main>

<footer>
  <p class="footer-text">Si vous aimez ce site, vous pouvez soutenir mon travail :</p>
  <p><a href="https://paypal.me/bobo33160" target="_blank" rel="noopener noreferrer" class="don-link" aria-label="Page de dons PayPal">Faire un don ici</a></p>
  <p class="footer-text">¬© 2025 - Tous droits r√©serv√©s</p>
</footer>

<script>
  // Liste de d√©fis (extraits, compl√©ter √† 365+)
  const defis = [
    "Dessinez un paysage en 10 minutes avec uniquement des formes g√©om√©triques.",
    "√âcrivez un ha√Øku sur le th√®me de la nature.",
    "Cr√©ez une mini histoire en 3 phrases avec un d√©but, milieu et fin.",
    "Inventez une recette avec trois ingr√©dients que vous avez chez vous.",
    "Fabriquez un origami simple et donnez-lui un nom unique.",
    "Programmez un script qui affiche la date et l'heure actuelles dans la console.",
    "Prenez une photo repr√©sentant un moment de bonheur aujourd'hui.",
    "Cr√©ez un logo minimaliste pour votre futur projet personnel.",
    "Apprenez et reproduisez une danse rapide d‚Äôune minute.",
    "√âcoutez un nouveau genre musical et √©crivez vos impressions en quelques lignes."
  ];

  // Mode sombre toggle & stockage pr√©f√©rence
  const darkModeToggle = document.getElementById('dark-mode-toggle');
  function loadDarkMode() {
    const mode = localStorage.getItem('darkModeEnabled');
    if (mode === 'true') {
      document.body.classList.add('dark-mode');
      darkModeToggle.setAttribute('aria-pressed', 'true');
      darkModeToggle.textContent = "Mode clair";
    } else {
      document.body.classList.remove('dark-mode');
      darkModeToggle.setAttribute('aria-pressed', 'false');
      darkModeToggle.textContent = "Mode sombre";
    }
  }
  darkModeToggle.addEventListener('click', () => {
    const active = document.body.classList.toggle('dark-mode');
    localStorage.setItem('darkModeEnabled', active);
    darkModeToggle.setAttribute('aria-pressed', active.toString());
    darkModeToggle.textContent = active ? "Mode clair" : "Mode sombre";
  });
  loadDarkMode();

  // Variables DOM
  const defiElement = document.getElementById("defi");
  const btnNouveau = document.getElementById("nouveauDefi");
  const form = document.getElementById("defiForm");
  const defiInput = document.getElementById("defiInput");
  const captchaInput = document.getElementById("captcha");
  const formError = document.getElementById("formError");
  const defisSubmitList = document.getElementById("defisSubmitList");
  const historiqueElement = document.getElementById("historiqueDefis");
  const exportBtn = document.getElementById("exportJournal");
  const notifToggle = document.getElementById("notifToggle");
  const badgesContainer = document.getElementById("badgesContainer");
  const searchHistorique = document.getElementById('searchHistorique');

  // Local storage keys
  const STORAGE_HISTO = 'historiqueDefis2025';
  const STORAGE_SUBMIT = 'defisSoumis2025';

  // Historique des d√©fis personnels
  let historique = JSON.parse(localStorage.getItem(STORAGE_HISTO)) || [];

  // D√©fis soumis par la communaut√©, avec votes
  let defisSoumis = JSON.parse(localStorage.getItem(STORAGE_SUBMIT)) || [];

  // G√©n√©ration d√©fi al√©atoire
  function genererDefi() {
    const index = Math.floor(Math.random() * defis.length);
    return defis[index];
  }
  function afficherDefi() {
    const nouveauDefi = genererDefi();
    defiElement.textContent = nouveauDefi;
  }
  btnNouveau.addEventListener("click", afficherDefi);
  afficherDefi();

  // Validation formulaire
  function validerForm() {
    formError.style.display = 'none';
    const texte = defiInput.value.trim();
    if (texte.length < 5 || texte.length > 150) {
      formError.textContent = "Le d√©fi doit contenir entre 5 et 150 caract√®res.";
      formError.style.display = 'block';
      return false;
    }
    if (captchaInput.value.trim() !== '5') {
      formError.textContent = "Le r√©sultat du captcha est incorrect.";
      formError.style.display = 'block';
      return false;
    }
    return true;
  }

  // Ajout d√©fi soumis
  function ajouterDefiSoumis(text) {
    defisSoumis.unshift({text: text, votes: 0});
    localStorage.setItem(STORAGE_SUBMIT, JSON.stringify(defisSoumis));
    afficherDefisSoumis();
  }

  // Affichage d√©fis soumis
  function afficherDefisSoumis() {
    defisSubmitList.innerHTML = '';
    if(defisSoumis.length === 0) {
      defisSubmitList.innerHTML = '<li>Aucun d√©fi soumis pour l\'instant.</li>';
      return;
    }
    defisSoumis.forEach((defi, index) => {
      const li = document.createElement('li');
      li.style.marginBottom = '1rem';
      li.innerHTML = `
        <div>${defi.text}</div>
        <button data-index="${index}" class="voteBtn" aria-label="Votez pour ce d√©fi">${defi.votes || 0} üëç</button>
      `;
      defisSubmitList.appendChild(li);
    });
    // Boutons vote avec √©coute
    document.querySelectorAll('.voteBtn').forEach(btn => {
      btn.onclick = () => {
        const i = +btn.dataset.index;
        defisSoumis[i].votes = (defisSoumis[i].votes || 0) + 1;
        localStorage.setItem(STORAGE_SUBMIT, JSON.stringify(defisSoumis));
        afficherDefisSoumis();
      };
    });
  }
  afficherDefisSoumis();

  // Soumission formulaire modifi√©
  form.addEventListener("submit", (e) => {
    e.preventDefault();
    if (!validerForm()) return;
    ajouterDefiSoumis(defiInput.value.trim());

    // Ajout aussi dans historique perso
    historique.unshift(defiInput.value.trim());
    localStorage.setItem(STORAGE_HISTO, JSON.stringify(historique));
    afficherHistorique();
    updateBadges();

    defiInput.value = "";
    captchaInput.value = "";
    formError.style.display = 'none';
    alert("Merci pour votre contribution !");
  });

  // Afficher historique perso
  function afficherHistorique(filter = '') {
    historiqueElement.innerHTML = '';
    let filtered = historique;
    if(filter.length > 0){
      filtered = historique.filter(d => d.toLowerCase().includes(filter.toLowerCase()));
    }
    if(filtered.length === 0) {
      const li = document.createElement('li');
      li.textContent = filter.length > 0 ? "Aucun d√©fi ne correspond √† votre recherche." : "Aucun d√©fi encore r√©alis√© ou ajout√©.";
      historiqueElement.appendChild(li);
      return;
    }
    filtered.forEach((d) => {
      const li = document.createElement('li');
      li.textContent = d;
      historiqueElement.appendChild(li);
    });
  }
  afficherHistorique();

  // Recherche dans historique
  searchHistorique.addEventListener('input', () => {
    afficherHistorique(searchHistorique.value);
  });

  // Export du journal perso
  exportBtn.addEventListener("click", () => {
    if(historique.length === 0) {
      alert("Votre journal est vide.");
      return;
    }
    const texteExport = historique.map((d, i) => `${i+1}. ${d}`).join("\n");
    const blob = new Blob([texteExport], {type: 'text/plain'});
    const url = URL.createObjectURL(blob);
    const a = document.createElement('a');
    a.href = url;
    a.download = 'journal_defis_2025.txt';
    document.body.appendChild(a);
    a.click();
    document.body.removeChild(a);
    URL.revokeObjectURL(url);
  });

  // Badges gamifi√©s
  function updateBadges() {
    badgesContainer.innerHTML = '';
    const nbDefis = historique.length;
    const badges = [];

    if(nbDefis >= 5) badges.push('Novice - 5 d√©fis r√©alis√©s');
    if(nbDefis >= 20) badges.push('Apprenti - 20 d√©fis r√©alis√©s');
    if(nbDefis >= 50) badges.push('Expert - 50 d√©fis r√©alis√©s');
    if(nbDefis >= 100) badges.push('Ma√Ætre - 100 d√©fis r√©alis√©s');
    if(nbDefis >= 200) badges.push('L√©gende - 200 d√©fis r√©alis√©s');

    if(badges.length === 0) {
      badgesContainer.textContent = "Aucun badge pour le moment, continuez √† relever des d√©fis !";
    } else {
      badges.forEach(badge => {
        const div = document.createElement('div');
        div.textContent = `üèÖ ${badge}`;
        div.style.padding = '0.5rem';
        div.style.backgroundColor = '#d4f4dd';
        div.style.borderRadius = '5px';
        div.style.marginBottom = '0.3rem';
        badgesContainer.appendChild(div);
      });
    }
  }
  updateBadges();

  // Partage r√©seaux sociaux
  const shareTwitter = document.getElementById('shareTwitter');
  const shareFacebook = document.getElementById('shareFacebook');
  const shareWhatsApp = document.getElementById('shareWhatsApp');

  function encode(text) {
    return encodeURIComponent(text);
  }

  shareTwitter.addEventListener('click', () => {
    const url = `https://twitter.com/intent/tweet?text=${encode('D√©fi du jour : ' + defiElement.textContent)}`;
    window.open(url, '_blank', 'noopener');
  });

  shareFacebook.addEventListener('click', () => {
    const url = `https://www.facebook.com/sharer/sharer.php?u=${encode(window.location.href)}&quote=${encode('D√©fi du jour : ' + defiElement.textContent)}`;
    window.open(url, '_blank', 'noopener');
  });

  shareWhatsApp.addEventListener('click', () => {
    const url = `https://api.whatsapp.com/send?text=${encode('D√©fi du jour : ' + defiElement.textContent + ' - ' + window.location.href)}`;
    window.open(url, '_blank', 'noopener');
  });

  // Notifications rappel - demande permission et notifications
  function showNotification() {
    if(Notification.permission === "granted") {
      new Notification("D√©fi cr√©atif du jour", {
        body: defiElement.textContent,
        icon: "https://cdn-icons-png.flaticon.com/512/686/686308.png"
      });
    }
  }

  notifToggle.addEventListener("change", () => {
    if (notifToggle.checked) {
      if (Notification.permission === "default") {
        Notification.requestPermission().then(permission => {
          if(permission !== "granted") {
            notifToggle.checked = false;
            alert("Notification non autoris√©e.");
          }
        });
      }
      localStorage.setItem('notifEnabled', "true");
      setTimeout(showNotification, 1000 * 60 * 60 * 24); // 24h
    } else {
      localStorage.setItem('notifEnabled', "false");
    }
  });

  // Charger pr√©f√©rence notifications
  if(localStorage.getItem('notifEnabled') === "true") {
    notifToggle.checked = true; 
  }

  // Int√©gration Disqus - chat mod√©r√©
  var disqus_config = function () {
      this.page.url = window.location.href;
      this.page.identifier = window.location.pathname;
  };
  (function() {
    var d = document, s = d.createElement('script');
    s.src = 'https://VOTRE_ID_DISQUS.disqus.com/embed.js'; // Remplacez par votre ID Disqus ici
    s.setAttribute('data-timestamp', +new Date());
    (d.head || d.body).appendChild(s);
  })();

</script>

<noscript>Veuillez activer JavaScript pour voir les commentaires.</noscript>
</body>
</html>
